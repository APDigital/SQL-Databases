Tables and Relationships

CREATE TABLE Employee (
Id int IDENTITY NOT NULL PRIMARY KEY,
FirstName varchar(max)NOT NULL,
LastName varchar(max)NOT NULL,
Age int NULL,
Salary int NOT NULL,
JobPositionID int NOT NULL,
FOREIGN KEY (JobPositionID) REFERENCES JobPosition(Id)
)

CREATE TABLE JobPosition (
Id int IDENTITY NOT NULL PRIMARY KEY,
JobPosition varchar(max)NOT NULL
)

CREATE TABLE PensionFundTable (
Id int IDENTITY NOT NULL PRIMARY KEY,
EmployeeID int NOT NULL,
FOREIGN KEY (EmployeeID) REFERENCES Employee(Id),
Contribution int NULL,
PensionProviderID int NOT NULL,
FOREIGN KEY(PensionProviderID) REFERENCES PensionProvider(Id)
)

CREATE TABLE PensionProvider (
Id int IDENTITY NOT NULL PRIMARY KEY,
ProviderName varchar(max) NOT NULL,
DefaultProvider varchar(max)NOT NULL
)

-----------------------------------------------------------------------------------------------------------------------

Reading and Writing Data

INSERT INTO JobPosition(JobPosition) VALUES ('Sales Coordinator')
INSERT INTO JobPosition(JobPosition) VALUES ('Sales Assistant')
INSERT INTO JobPosition(JobPosition) VALUES ('Store Manager')

INSERT INTO Employee(FirstName, LastName, Age, Salary, JobPositionID) VALUES ('Fred', 'Williams', 28, 25000, 1)
INSERT INTO Employee(FirstName, LastName, Age, Salary, JobPositionID) VALUES ('Bob', 'Joseph', 32, 16000, 2)
INSERT INTO Employee(FirstName, LastName, Age, Salary, JobPositionID) VALUES ('Frank', 'Cole', 45, 40000, 3)
INSERT INTO Employee(FirstName, LastName, Age, Salary, JobPositionID) VALUES ('Peter', 'Brock', 21, 16000, 2)
INSERT INTO Employee(FirstName, LastName, Age, Salary, JobPositionID) VALUES ('Aisling', 'Parthe', 48, 21000, 2)


INSERT INTO PensionProvider(DefaultProvider, ProviderName) VALUES ('True', 'Pension Plus')
INSERT INTO PensionProvider(DefaultProvider, ProviderName) VALUES ('False', 'Retirement Planning Co.')
INSERT INTO PensionProvider(DefaultProvider, ProviderName) VALUES ('False', 'VIP Pension Provider')


INSERT INTO PensionFundTable(EmployeeID, Contribution, PensionProviderID) VALUES (1,2500,1)
INSERT INTO PensionFundTable(EmployeeID, Contribution, PensionProviderID) VALUES (2,3300,1)
INSERT INTO PensionFundTable(EmployeeID, Contribution, PensionProviderID) VALUES (3,11000,2)
INSERT INTO PensionFundTable(EmployeeID, Contribution, PensionProviderID) VALUES (3,28000,3)
INSERT INTO PensionFundTable(EmployeeID, Contribution, PensionProviderID) VALUES (4,15000,2)
INSERT INTO PensionFundTable(EmployeeID, Contribution, PensionProviderID) VALUES (5,10000,2)


Select First and last name of employees under the age of 35 :

SELECT FirstName + ' ' + LastName  FROM Employee WHERE	Age > 35

update pension contribution by 5% :

UPDATE PensionFundTable 
SET Contribution = Contribution * 1.05

-----------------------------------------------------------------------------------------------------------------------
Aggregates Joins and Subqueries

Find the average salary for each job position :

SELECT AVG(Salary) AS AverageSalary, JobPositionID FROM Employee GROUP BY JobPositionID

Work out how many people have their funds with each pension provider:

SELECT COUNT(EmployeeID) AS NumberOfEmployees, PensionProviderID FROM PensionFundTable GROUP BY PensionProviderID

Find all employees without pension funds :

INSERT INTO Employee(FirstName, LastName, Age, Salary, JobPositionID) VALUES ('Ben', 'Davis', 38, 26000,1)
INSERT INTO PensionProvider(DefaultProvider, ProviderName) VALUES ('False', 'No Provider')
INSERT INTO PensionFundTable(EmployeeID, Contribution, PensionProviderID) VALUES (6,0,4)

SELECT Employee.FirstName + ' ' + Employee.LastName AS EmployeeName, PensionFundTable.PensionProviderID
FROM Employee
JOIN PensionFundTable
On PensionFundTable.EmployeeID = Employee.Id
WHERE PensionProviderID = 4

UPDATE PensionFundTable
Set PensionProviderID =  (
SELECT PensionProvider.Id 
FROM PensionProvider
WHERE DefaultProvider = 'True'
)
WHERE PensionProviderID = 4;

-----------------------------------------------------------------------------------------------------------------------



